<br />
<section class="row">
	<div class="col-md-8 mx-auto shadow p-5">
		<div class="row">
			<div class="col-md-6">
			    <h3>Invoice</h3>
			    <h5>Billing Information</h5>
			</div>
			<div class="col-md-6">
			<br />
				<div class="float-right" style="width: 40%;">
				    <p id="shopName" class="m-0"></p>
				    <p id="shopAddress" class="m-0"></p>
				    <p id="shopMobile" class="m-0"></p>
				</div>
			</div>
		</div>
		<br />
		<div class="row">
			<div class="col-md-6">
			    <input type="hidden" id="cusId">
			    <p id="cusName" class="m-0"></p>
			    <p id="cusAddress" class="m-0"></p>
			    <p id="cusMobile" class="m-0"></p>
			    <p id="cusEmail" class="m-0"></p>
			</div>
			<div class="col-md-6">
				<div class="float-right" style="width: 40%;">
				    <p id="orderNo" class="m-0"></p>
				    <p id="orderDate" class="m-0"></p>
				    <p id="paymentMethod" class="m-0"></p>
				</div>
			</div>
		</div>
		<br />
		<div class="row">
			<table class="table">
			  <thead>
			    <tr>
			      <th scope="col" style="width: 10%;">#</th>
			      <th scope="col">Item</th>
			      <th scope="col" style="width: 10%;">Qty</th>
			      <th scope="col" style="width: 10%;">Price</th>
			      <th scope="col" style="width: 10%;">Total</th>
			    </tr>
			  </thead>
			  <tbody id="tabelBody">

			  </tbody>
			</table>
		</div>
		<div class="row">
			<div class="col-md-6">
			</div>
			<div class="col-md-6">
				<div class="">
					<hr>
					<p class="d-flex justify-content-between"><small class="">Sub Total:</small><small><small>TK </small><small id="subTotalAmtLbl"> 0</small></small></p>
					<p class="d-flex justify-content-between"><small class="">Vat Total:</small><small><small>TK </small><small id="vatTotalAmtLbl"> 0</small></small></p>
					<p id="shippingDetails"class="d-flex justify-content-between pb-2"><small class="">Shipping</small><small><small>TK </small><small id="shippingAmtLbl">0</small></small></p>
					<p class="d-flex justify-content-between"><small class="b">Total:</small><small class="b"><small>TK </small><small id="totalAmtLbl" class="b">0</small></small></p>
				</div>
			</div>
		</div>
	</div>
</section>



<script>
var shop = window.localStorage.getItem("genericfosshop")
if (shop !== null) {
	shop = JSON.parse(shop);
	

}

function getInvoice(){
	var invoiceId = window.localStorage.getItem("genericfosinv");
	var request = $.ajax({
		url: root + "/api/invoices/byid",
		type: "POST",
		data: JSON.stringify({
			id: invoiceId
		}),
		headers: {
			'Accept': 'application/json',
			'Content-Type': 'application/json',
            "Authorization": 'Bearer ' + userDetails.accessToken
		},
	});

	request.done(function (invoice) {
		$("#cusId").val(invoice.customerId);
	    $("#cusName").text(invoice.customer);
	    $("#cusAddress").text(invoice.string3);
	    $("#cusMobile").text(invoice.string2);
	    //$("#cusEmail").text(data.email);
	    
	    $("#orderNo").text("GFOS"+invoice.id);
	    $("#orderDate").text(invoice.dateCreated.slice(0, 10));
	    $("#paymentMethod").text(invoice.paymentType);
	    
	    $("#subTotalAmtLbl").text(invoice.totalAmt);
	    $("#vatTotalAmtLbl").text(invoice.vatAmt);
	    $("#shippingAmtLbl").text(invoice.integer1);
	    $("#totalAmtLbl").text(invoice.netAmt+invoice.integer1);
				    
		var request2 = $.ajax({
			url: root + "/api/invoiceitems/byinvoiceid",
			type: "POST",
			data: JSON.stringify({
				id: invoiceId
			}),
			headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json',
	            "Authorization": 'Bearer ' + userDetails.accessToken
			},
		});

		request2.done(function (invoiceItem) {
			for (var i = 0; i < invoiceItem.length; i++) {
			    var html = 	'<tr>'+
						      '<th>'+parseInt(i+1)+'</th>'+
						      '<td>'+invoiceItem[i].name+'</td>'+
						      '<td>'+invoiceItem[i].quantity+'</td>'+
						      '<td>'+invoiceItem[i].price / invoiceItem[i].quantity+'</td>'+
						      '<td>'+invoiceItem[i].price+'</td>'+
						    '</tr>';
				$("#tabelBody").append(html);
			}

		});

		request2.fail(function (jqXHR, textStatus) {
			alert("Request failed: " + jqXHR.responseJSON.message);
		});
		
		var request = $.ajax({
			url: root + "/api/users/shopbyid",
			type: "POST",
			data: JSON.stringify({
				id: invoice.shop,
			}),
			headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json',
				"Authorization": 'Bearer ' + userDetails.accessToken
			},
		});

		request.done(function (shop) {
		    $("#shopName").text(shop.firstname+" "+shop.lastname);
		    $("#shopAddress").text(shop.address);
		    $("#shopMobile").text(shop.mobile);
		});

		request.fail(function (jqXHR, textStatus) {
			alert("Request failed: " + textStatus);
		});
	});

	request.fail(function (jqXHR, textStatus) {
		alert("Request failed: " + jqXHR.responseJSON.message);
	});
}
getInvoice();
</script>